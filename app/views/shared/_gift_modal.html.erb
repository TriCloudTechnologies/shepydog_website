<!-- Modal -->
<div class="modal fade" id="giftModal" tabindex="-1" aria-labelledby="giftModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <%= image_tag "logo.png", class: "img-fluid me-4", width: "40px" %>
        <h1 class="modal-title fs-5" id="exampleModalLabel">Gift Purchase Shepydogs</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <span>Wallet Address:</span>
        <input class="form-control" id="walletAddress" type="text" value="<%= current_user.wallet_address %>" />
        <br>
        <div class="d-flex gap-3">
          <button class="btn bg-color-gold" onclick="adjustGiftCountValue(-1)">-</button>
          <input class="text-end form-control w-75" id="giftCoinCount" type="number" />
          <button class="btn bg-color-gold" onclick="adjustGiftCountValue(1)">+</button>
        </div>
      </div>

      <div class="row px-4">
        <div class="col-12">
          <span class="fs-5 fw-bold">Total Amount</span>
          <span id="totalGiftCoins">0</span>
          <span class="me-3">x</span>
          <span id="giftEthValue"><%= @token_details[9].to_f/10**18 %></span>
          <span>ETH</span>
          <span> = </span>
          <span id="giftTotalAmount">0</span>
          <span>ETH</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn bg-color-gold" onclick="proceedGiftTransaction()">Proceed</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  function adjustGiftCountValue(value) {
    const input = document.getElementById('giftCoinCount');
    input.value = Number(input.value) + value;
    document.getElementById('totalGiftCoins').innerHTML = input.value;

    valueElement = document.getElementById('giftEthValue');
    const numberString = valueElement.textContent || valueElement.innerText;
    const numberValue = parseFloat(numberString);
    document.getElementById('giftTotalAmount').innerHTML = (numberValue * input.value).toFixed(6);
  }

  async function proceedGiftTransaction() {
    const coinsCount = document.getElementById('giftCoinCount').value;

    const contractAddress = '0xADB2288bc444a6E76D723C27Fc8a100b1446b96a';
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner(); 
    const contractABI = [
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "_tokenQuantity",
            "type": "uint256"
          },
          {
            "internalType": "address",
            "name": "_recieverAddress",
            "type": "address"
          }
        ],
        "name": "giftTokens",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    const contract = new ethers.Contract(contractAddress, contractABI, signer);
    const walletAddress = document.getElementById('walletAddress').value;

    await contract.giftTokens(parseInt(coinsCount), walletAddress);
  }
</script>